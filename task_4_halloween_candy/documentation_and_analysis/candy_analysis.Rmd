---
title: "candy_analysis"
author: "Lauren Davidson"
date: "15/12/2020"
output: html_document
---

```{r}
library(tidyverse)
library(here)

candy <- read_csv(here("clean_data/clean_candy_2015_to_2017.csv"))
```

# Q1: What is the total number of candy ratings given across the three years. (number of candy ratings, not number of raters. Donâ€™t count missing values)
......... ratings of Hallowe'en treats across the three years. Treats reviewed include non-candy snacks and gifts

```{r}
# Count number of values as I have dropped non-treat questions and NA reaction
candy %>% 
  summarise(num_candy_ratings = n())
```

# Q2: What was the average age of people who are going out trick or treating and the average age of people not going trick or treating?

Those going out trick or treating have an average age of .... years.
Those staying in have an average age of .... years.
The average age for the dataset is ..., which is not exactly the age we expect of trick and treaters and candy eaters.

```{r}
candy %>% 
  # Remove ages which are likely to be joke or answers or typos
  filter(age < 120 & age > 0) %>% 
  group_by(treating) %>% 
  summarise(average_age = mean(age, na.rm = TRUE))

candy %>% 
  filter(age < 120 & age > 0) %>% 
  summarise(average_age = mean(age, na.rm = TRUE))
```


# Q3: For each of joy, despair and meh, which candy bar revived the most of these ratings?

```{r}
candy %>% 
  group_by(candy) %>% 
  summarise(num_joy = sum(reaction == "JOY")) %>% 
  slice_max(num_joy)
```


```{r}
candy %>% 
  group_by(candy) %>% 
  summarise(num_despair = sum(reaction == "DESPAIR")) %>% 
  slice_max(num_despair)
```


```{r}
candy %>% 
  group_by(candy) %>% 
  summarise(num_meh = sum(reaction == "MEH")) %>% 
  slice_max(num_meh)
```

# Q4:How many people rated Starburst as despair?

..... raters rated Starburst with a despair reaction.

```{r}
candy %>% 
  filter(candy == "Starburst" &
         reaction == "DESPAIR") %>% 
  summarise(num_rating_starburst_as_despair = n())
```

# Q5: For the next three questions, count despair as -1, joy as +1 and meh as 0.

```{r}
rated_candy <- candy %>% 
  mutate(
    numeric_rating = case_when(
      reaction == "JOY" ~ 1,
      reaction == "DESPAIR" ~ -1,
      reaction == "MEH" ~ 0
    )
  )
```


# Q6: What was the most popular candy bar by this rating system for each gender in the dataset?

```{r}
# Get a rating for each candy bar by each gender, name this "rank"
gender_rated_candy <- rated_candy %>% 
  group_by(gender, candy) %>% 
  mutate(rank = sum(numeric_rating))
```


```{r}
# Return highest ranked candy for male
gender_rated_candy %>% 
  select(candy, gender, rank) %>% 
  filter(gender == "Male") %>%
  slice_max(rank)
```


```{r}
# Return highest ranked candy for female
gender_rated_candy %>% 
  select(candy, gender, rank) %>% 
  filter(gender == "Female") %>%
  slice_max(rank)
```


```{r}
# Return highest ranked candy for other genders
gender_rated_candy %>% 
  select(candy, gender, rank) %>% 
  filter(gender == "Other") %>%
  slice_max(rank)
```


```{r}
# Return highest ranked candy for NA genders
gender_rated_candy %>% 
  select(candy, gender, rank) %>% 
  filter(is.na(gender)) %>%
  slice_max(rank)
```

# Q7: What was the most popular candy bar in each year?

```{r}
# Highest ranked 2015
rated_candy %>% 
  filter(year == 2015) %>% 
  group_by(candy) %>% 
  summarise(rank = sum(numeric_rating)) %>% 
  arrange(desc(rank)) %>% 
  head(1)
```
```{r}
# Highest ranked 2016
rated_candy %>% 
  filter(year == 2016) %>% 
  group_by(candy) %>% 
  summarise(rank = sum(numeric_rating)) %>% 
  arrange(desc(rank)) %>% 
  head(1)
```

```{r}
# Highest ranked 2017
rated_candy %>% 
  filter(year == 2017) %>% 
  group_by(candy) %>% 
  summarise(rank = sum(numeric_rating)) %>% 
  arrange(desc(rank)) %>% 
  head(1)
```

# Q8: What was the most popular candy bar by this rating for people in US, Canada, UK and all other countries?

